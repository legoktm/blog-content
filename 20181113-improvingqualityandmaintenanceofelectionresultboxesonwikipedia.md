Title: Improving quality and maintenance of election result boxes on Wikipedia
Date: 2018-11-13 09:05:55
Category: MediaWiki
Tags: wikipedia

I've spent a decent amount of time reading Wikipedia articles about Senate, House, and state races this week. And...there were inconsistencies. Specifically in the election box result templates:

![Before I updated the article]({static}/images/Screenshot_2018-11-13 California's 5th congressional district Difference between revisions - Wikipedia.png)

That's what it looked like before I updated the article to use my template instead. There are a few different issues. First, Mike Thompson isn't marked as the incumbent. And second, the total number of votes is wrong - if you do the math, it adds up to 292,091. There are two more cosmetic issues: 1) the % column should go to one decimal point, and 2) the empty turnout field should be hidden since we don't have that data available.

![The fixed version]({static}/images/Screenshot_2018-11-13 California's 5th congressional district - Wikipedia fixed.png)

That's the fixed version, that's using my template. So what's different? The main thing that most editors will notice is the amount of wikitext it took to generate my version: <code>{{election box US auto|California|2016|United States Representative District 5|Mike Thompson link=Mike Thompson (California politician)}}</code>. Compare that to [what was needed previously](https://en.wikipedia.org/w/index.php?title=California%27s_5th_congressional_district&type=revision&diff=868423606&oldid=867847666). I think it's a pretty big improvement. Oh, and if you set the year to a comma separated list, like "2012,2014,2016", it'll [generate all three boxes at once](https://en.wikipedia.org/w/index.php?title=California%27s_5th_congressional_district&type=revision&diff=868591076&oldid=868575716), so it becomes even easier to use.

This will also reduce the maintenance burden significantly. These boxes are copied to other articles, including [Mike Thompson (California politician)](https://en.wikipedia.org/w/index.php?title=Mike_Thompson_(California_politician)&oldid=868024170#Electoral_history), which is using the wrong styles and missing the 2016 general election entirely, and on [United States House of Representatives elections in California, 2016](https://en.wikipedia.org/wiki/United_States_House_of_Representatives_elections_in_California,_2016#District_5), which actually looks correct!

This is all being generated by a single [Lua module](https://en.wikipedia.org/wiki/Wikipedia:Lua) called [Module:Election box US auto](https://en.wikipedia.org/wiki/Module:Election_box_US_auto), and a tabular data spreadsheet [that's available on Commons](https://commons.wikimedia.org/wiki/Data:California_Elections/2016/General/Candidates.tab). The Lua code isn't the cleanest, but it proves that we can replace things that were manually maintained with smarter templates that do most of the heavy lifting. To the best of my knowledge, this appears to be the first usage of the new [tabular data](https://www.mediawiki.org/wiki/Help:Tabular_Data) system in English Wikipedia articles. I've updated the [California's 1st congressional district](https://en.wikipedia.org/wiki/California's_1st_congressional_district) through 8th district articles to use the "auto" template so far.

What's next? I'm going to import the [MIT Election Data for the US House](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/IG0UN2) dataset to Commons so we can start using this in more articles outside of California soon ([waiting on bot approval](https://commons.wikimedia.org/wiki/Commons:Bots/Requests/Legobot_3)). The only thing that's missing from that dataset is incumbency data - it doesn't indicate whether the candidate was running as an incumbent (so if you know of incumbency data, please let me know!). And once we get the House in good shape, we can move onto the Senate and then state races. Aaaand I've even had someone ask me about expanding this to other countries, which should totally be doable! Anything is possible with Lua+tabular data.
